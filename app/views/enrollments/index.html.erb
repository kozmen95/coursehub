<% content_for :title, "Zapisani studenci" %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-700 font-medium rounded-md inline-block"><%= notice %></p>
  <% elsif alert.present? %>
    <p class="py-2 px-3 bg-red-50 mb-5 text-red-700 font-medium rounded-md inline-block"><%= alert %></p>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="font-bold text-2xl">ğŸ“‹ Lista zapisÃ³w dla kursu: <%= @course.title %></h1>
  </div>

  <% if @enrollments.any? %>
    <table class="min-w-full divide-y divide-gray-200 border border-gray-300">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Student</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Email</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Status</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Akcje</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% @enrollments.each do |enrollment| %>
          <tr>
            <td class="px-4 py-2"><%= enrollment.user.email.split("@").first %></td>
            <td class="px-4 py-2"><%= enrollment.user.email %></td>
            <td class="px-4 py-2 font-medium"><%= enrollment.status %></td>
            <td class="px-4 py-2 flex space-x-2">
              <% if policy(enrollment).update? %>
                <% unless enrollment.confirmed? %>
                  <%= button_to "PotwierdÅº", course_enrollment_path(@course, enrollment, status: :confirmed),
                                method: :patch,
                                class: "bg-green-600 hover:bg-green-500 text-white px-3 py-1 rounded" %>
                <% end %>
                <% unless enrollment.rejected? %>
                  <%= button_to "OdrzuÄ‡", course_enrollment_path(@course, enrollment, status: :rejected),
                                method: :patch,
                                class: "bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded" %>
                <% end %>
              <% end %>

              <% if policy(enrollment).destroy? %>
                <%= button_to "UsuÅ„", course_enrollment_path(@course, enrollment),
                              method: :delete,
                              class: "bg-gray-600 hover:bg-gray-500 text-white px-3 py-1 rounded",
                              data: { turbo_confirm: "Na pewno usunÄ…Ä‡ zapis?" } %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="text-center text-gray-500 my-10">Brak zapisanych studentÃ³w.</p>
  <% end %>
</div>
